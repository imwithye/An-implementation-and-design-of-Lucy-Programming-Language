%!TEX root = ../dissertation.tex
\begin{savequote}[75mm]
A language that doesn't affect the way you think about programming is not worth knowing.
\qauthor{Alan J. Perlis}
\end{savequote}

\chapter{Lucy Programming Language}
Donec pharetra, lorem at commodo facilisis, erat nisl luctus tellus, sed bibendum nisl justo quis neque. In maximus vitae felis ac viverra. Cras aliquam, orci id posuere porta, odio velit bibendum ligula, ac accumsan nulla quam non est. Vestibulum rutrum elementum nulla, a pulvinar nulla suscipit nec. Praesent id diam at enim varius iaculis. Duis pretium vestibulum quam. Sed eu nunc non sapien tincidunt faucibus. Ut non maximus mi. Sed porttitor in augue vitae semper. Vivamus sed dapibus orci. Fusce vulputate nisi luctus imperdiet ultricies. Sed pretium at magna non varius.


\section{A Tour with Lucy}
Tradition suggests that the first program in a new language should print the words "Hello World!" on the screen. In Lucy Programming Language, it can be done with invoking the print function from the std library.
\begin{lstlisting}
import "std"

func main() {
  std::print("Hello World!")
}
\end{lstlisting}
If you have written code in C or C++, this code will be very familiar to you. The Lucy codes starts from the main function, which is very similar to C programming language, and it will execute the code line by line. Moreover, unlike C and C++, Lucy does not require semicolons at the end of every statement.

Lucy does not requires the main function returns a int number as the program's exiting code and in fact, the virtual machine will detect the return statement during run time and return a none value if the function does not return anything. The detailed description of the function behavior will be introduced in function section. Though Lucy is a dynamic type programming language, i.e. the type of the the variable can be changed during run time, Lucy still requires compiling and linking to the Lucy X assembly code so that it can be interpreted by Lucy Virtual Machine. The mechanism behind Lucy, Lucy X and its virtual machine will be discussed in compilation and linking section. Lucy aims to provide a way to mix static type and dynamic type. The front-end semantic checker will ensure the correctness of the static type in static assignment, and the virtual machine will ensure the correctness of the assignment of dynamic type. The trade-offs of this syntax design and the implementation will be discussed in the syntax design section and the implementation chapter.

\subsection{Simple Value}
Lucy uses var keyword to create a variable and the initial value of the variable will be set to none if no type keyword is given.
\begin{lstlisting}
var a             // a is a optional type variable with none value
var a = 10        // a is a number type variable with number value 10
var a:number      // a is a number type variable with number value 0
var a:number = 10 // a is a number type variable with number value 10
\end{lstlisting}
A comma can be used to separate the var declaration and to assign the variable a static type, type keyword should be present after every single declaration. For example:
\begin{lstlisting}
var a, b:number   // a is optional type but b is number type
var a:number, b:number // both a and b are number type
\end{lstlisting}
The default value of the build types are set as following:
\begin{itemize}
  \item number: 0
  \item boolean: false
  \item string: ""
  \item array: []
  \item optional: none
\end{itemize}

\subsection{Array}
In Lucy, array is a primitive type and is passed by value when invoking a function call. Lucy provides 3 low level instructions, getter, setter and len function, to access array items and attributes.
\begin{lstlisting}
var length = len(array)
var value = array[0]
array[0] = value
\end{lstlisting}
Inside the array, all items will be considered as optional type. So an two dimensional arrays can be implemented by an array that contains another one dimensional array. Array also can be represented as a literal value. For example:
\begin{lstlisting}
var array = [none, 0, false, ""]
\end{lstlisting}
The + operator is used to concatenate two arrays and the result will be a new array that contains all elements of these two. When copying values to the new array, deep copy strategy is used so that every value inside these two arrays will be copied to the result array. For example:
\begin{lstlisting}
var result = ["hello", 0] + [0, [1, "world"]]
result == ["hello", 0, 0, [1, "world"]]
\end{lstlisting}

\subsection{Type}
Lucy is a dynamic type programming language, which means the type of the variable can be changed during the runtime. But Lucy also provides a static type checking system which introduces the optional type the the language. In Lucy, a variable without associating a type keyword will be considered as an optional type value. Only the type of the variables of the optional types can be changed during runtime. For example:
\begin{lstlisting}
var a = 0      // a is a variable of optional type
a = "string"
a = false
\end{lstlisting}
Moreover, a variable of optional type can be assigned with any types but a variable of a fixed type can only be assigned with the value of that type. For example:
\begin{lstlisting}
var a, b:number  // a is optional but b is number
a = b            // valid
b = a            // invalid; type error
\end{lstlisting}
Optional type will propagate to the expression when connecting two different values:
\begin{lstlisting}
var a = 0, b:number = 0
var c = a + b        // c is optional type
\end{lstlisting}
The assignment rule is also used in function parameter. A number value can be passed to a function with number type or optional type parameter. An optional value can only be passed to functions with optional type parameter. For example:
\begin{lstlisting}
func add(a, b) {
  return a + b
}

func add_n(a: number, b: number): number {
  return a + b
}

func add_s(a, b:number): string {
  return std::string(a) + std::string(b)
}

func add_s_invalid(a, b:number): string {
  return a + std::string(b)      // invalid; optional propagation
}

func main() {
  var a = add("hello", "world")  // valid
  var b = add(0, 1)  // valid    // invalid
  var c = add_n("hello", "world") // invalid
  var d = add_n(0, 1)             // valid
}
\end{lstlisting}
In the function definition, if there is no type keyword after the function signature, Lucy will treat it as optional type. If the function returns a value, it will simply return the result to the caller. If the function does not return any thing, the function will will return a none to the caller. The detailed behavior of the function will be discussed in the function section.

\subsection{Control Flow}


\subsection{Function}
Pellentesque congue maximus massa in iaculis. Pellentesque id quam interdum, aliquet massa ornare, fermentum purus. Cras vitae sollicitudin urna. Praesent iaculis, nisl et bibendum mollis, risus quam lacinia ipsum, id mattis magna est mollis purus. Sed et aliquet nulla. Phasellus ac risus iaculis, posuere ex hendrerit, scelerisque risus. In pharetra tincidunt dignissim. Morbi rutrum posuere facilisis. Donec at congue sapien. Nullam gravida sollicitudin est vel accumsan. Aenean at ipsum est. Proin mollis, odio sed dignissim elementum, diam lorem tincidunt metus, a dictum urna sem quis urna. Ut maximus felis ac enim ultricies tristique. Ut ac blandit libero. Cras dignissim orci nec augue porttitor congue.
\begin{lstlisting}[language=Lucy]
  func main() {
    std::print("Hello World")
  }
\end{lstlisting}
Duis vulputate tincidunt porta. Donec maximus lorem lacinia nulla hendrerit accumsan. Curabitur elementum turpis quis ipsum dapibus blandit. Integer ac ex et enim convallis rutrum non vel massa. Vestibulum nec ligula scelerisque, blandit ipsum vitae, accumsan risus. Donec suscipit sem orci, porttitor volutpat tortor luctus sed. Integer posuere at risus vel fringilla. Curabitur condimentum eget enim nec varius. Phasellus auctor lacus est, non ornare massa finibus condimentum. Cras laoreet et odio vitae fermentum. Ut nec nulla vel eros aliquam vulputate. Vestibulum quam mauris, rutrum vitae turpis id, efficitur sagittis massa. Sed porttitor nisi vel massa fermentum molestie. Sed justo ligula, pellentesque at accumsan vitae, malesuada sit amet felis. Praesent sit amet arcu nibh.
\begin{lstlisting}[language=Lucy]
  func fibonacci(n) {
    if n < 2 {
      return n
    } else {
      return fibonacci(n-1) + fibonacci(n-2)
    }
  }
\end{lstlisting}

\subsection{Parameter Passing}
Vivamus ac orci ut mi ultrices scelerisque. Sed congue scelerisque neque, a eleifend velit vestibulum quis. Curabitur suscipit efficitur tortor, non aliquam leo consectetur ut. Quisque quis magna non ipsum lobortis malesuada dignissim ac enim. Donec at efficitur ipsum. Aliquam erat volutpat. Proin metus nulla, luctus et libero sed, tincidunt bibendum elit.


\section{Code Organization}
Vivamus vel rutrum est, in feugiat mauris. Aenean quis odio id quam maximus faucibus. Nulla a ultrices velit. Sed viverra ultricies vestibulum. Donec eget neque a diam viverra rhoncus et sed erat. Pellentesque ut magna dolor. Nulla fringilla enim quam, eget posuere justo tristique eu. Nam imperdiet ex vitae volutpat sodales. Donec bibendum placerat ipsum id dictum. Aenean eget justo lobortis, molestie lectus id, mollis tellus. Fusce non ligula iaculis, mattis nulla non, lobortis mi. Donec id diam efficitur velit venenatis tincidunt a eu nibh. Fusce congue sem sed eleifend consectetur.

\subsection{File, Directory and Package}
Suspendisse potenti. Fusce volutpat erat dignissim velit luctus blandit. Vivamus tortor turpis, facilisis non massa sed, convallis varius nunc. Cras eu fringilla velit. Morbi accumsan posuere turpis vitae venenatis. Proin pellentesque purus quis elementum mollis. Vestibulum rutrum lectus in sagittis pulvinar. Suspendisse vulputate volutpat felis, et faucibus nisl. Nullam purus nunc, ornare ut nunc eget, congue auctor arcu. Nam a viverra justo. Nunc sodales lacinia mi sit amet dictum. Morbi eget vehicula nibh. Fusce est augue, elementum at finibus sagittis, ultrices vel sapien.

\subsection{Import, User and System Modules}
Vivamus porttitor mi leo, in convallis orci vestibulum vel. Maecenas scelerisque risus non nibh tempus scelerisque. Suspendisse eros erat, mattis in hendrerit ac, posuere id lacus. Nunc non nibh sed ex malesuada tempor. Suspendisse iaculis ex ut luctus hendrerit. Donec sed sem in felis facilisis posuere. Praesent odio massa, cursus in dolor nec, congue dictum nibh. Pellentesque blandit orci blandit ligula consequat, eu placerat ligula volutpat. Vestibulum eu eros finibus, congue ex sit amet, lobortis purus. Aliquam et cursus arcu. Nunc fringilla est ac nisl consectetur tempor. In hac habitasse platea dictumst. Suspendisse sollicitudin cursus nibh, vel ultricies nisi pharetra quis. Aliquam commodo nibh ut velit eleifend pellentesque. Aenean sit amet neque venenatis, volutpat dui eget, aliquet arcu.


\section{Syntax Design and Trade-offs}
Quisque molestie ornare ante, sit amet commodo urna. In hac habitasse platea dictumst. Aenean maximus aliquam leo vel ultrices. Vestibulum at maximus elit. Cras massa sem, iaculis nec ultricies a, gravida eu ligula. Aenean eleifend at erat quis fringilla. Cras eget fringilla ligula, in rhoncus lacus. Vestibulum lobortis enim vel velit laoreet cursus. Vivamus elementum suscipit nibh, nec mattis eros semper id. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Etiam lectus justo, laoreet non purus eu, lobortis elementum felis.

\subsection{Syntactic Sugar}
Vivamus porttitor mi leo, in convallis orci vestibulum vel. Maecenas scelerisque risus non nibh tempus scelerisque. Suspendisse eros erat, mattis in hendrerit ac, posuere id lacus. Nunc non nibh sed ex malesuada tempor. Suspendisse iaculis ex ut luctus hendrerit. Donec sed sem in felis facilisis posuere. Praesent odio massa, cursus in dolor nec, congue dictum nibh. Pellentesque blandit orci blandit ligula consequat, eu placerat ligula volutpat. Vestibulum eu eros finibus, congue ex sit amet, lobortis purus. Aliquam et cursus arcu. Nunc fringilla est ac nisl consectetur tempor. In hac habitasse platea dictumst. Suspendisse sollicitudin cursus nibh, vel ultricies nisi pharetra quis. Aliquam commodo nibh ut velit eleifend pellentesque. Aenean sit amet neque venenatis, volutpat dui eget, aliquet arcu.

\subsection{Passing by Values VS Passing by References}
Quisque molestie ornare ante, sit amet commodo urna. In hac habitasse platea dictumst. Aenean maximus aliquam leo vel ultrices. Vestibulum at maximus elit. Cras massa sem, iaculis nec ultricies a, gravida eu ligula. Aenean eleifend at erat quis fringilla. Cras eget fringilla ligula, in rhoncus lacus. Vestibulum lobortis enim vel velit laoreet cursus. Vivamus elementum suscipit nibh, nec mattis eros semper id. Vestibulum ante ipsum primis in faucibus orci luctus et ultrices posuere cubilia Curae; Etiam lectus justo, laoreet non purus eu, lobortis elementum felis.


\section{Compilation and Linking}
Suspendisse dictum lectus a nisl ultricies, in pharetra enim dignissim. Phasellus quis justo ornare, facilisis sem ut, dapibus ipsum. Nunc sed urna pharetra magna ornare viverra sodales ut mi. Vestibulum elementum ultrices elementum. Nullam ultrices tincidunt hendrerit. Cras condimentum, urna ut mollis porta, orci magna dapibus diam, quis interdum dui quam non arcu. Curabitur id lacus ex.

Nunc feugiat pharetra pulvinar. Nullam interdum tellus sit amet sagittis gravida. Duis aliquet vitae turpis sit amet vestibulum. Vivamus risus neque, rhoncus ut lacus molestie, ullamcorper volutpat enim. Ut nunc nisi, iaculis sed nisl non, efficitur rhoncus ex. Aenean posuere nibh sed hendrerit gravida. Nullam eu justo aliquam lorem gravida volutpat sed nec dui. Praesent dictum enim ut lacus mattis venenatis. Lorem ipsum dolor sit amet, consectetur adipiscing elit. Aliquam nisl urna, facilisis vitae efficitur quis, tristique venenatis lacus. Curabitur fringilla interdum dignissim. Nunc sapien turpis, aliquam non elit eget, lobortis cursus velit. Pellentesque pellentesque at nunc a varius. Phasellus molestie ante vitae enim viverra laoreet. Cras sem justo, interdum at gravida sit amet, lobortis sit amet leo.
\begin{lstlisting}[language=Bash]
  lucy -c files
\end{lstlisting}
